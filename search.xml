<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>centos7.5安装openshift3.11</title>
    <url>/2020/01/13/openshift%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="centos7-5安装openshift3-11"><a href="#centos7-5安装openshift3-11" class="headerlink" title="centos7.5安装openshift3.11"></a>centos7.5安装openshift3.11</h1><p>操作系统采用centos7.5，注意不要更换阿里元，安装会失败。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@openshift1 ~]# cat &#x2F;etc&#x2F;redhat-release </span><br><span class="line">CentOS Linux release 7.5.1804 (Core)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>主机</th>
<th>ip</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>openshift1</td>
<td>10.0.0.60</td>
<td>compute,infra,master</td>
</tr>
<tr>
<td>openshift2</td>
<td>10.0.0.63</td>
<td>compute,infra,master</td>
</tr>
<tr>
<td>openshift3</td>
<td>10.0.5.17</td>
<td>compute,infra,master</td>
</tr>
<tr>
<td>openshift4</td>
<td>10.0.5.8</td>
<td>compute,infra,master</td>
</tr>
</tbody></table>
<h2 id="下载离线包"><a href="#下载离线包" class="headerlink" title="下载离线包"></a>下载离线包</h2><h3 id="docker镜像"><a href="#docker镜像" class="headerlink" title="docker镜像"></a>docker镜像</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install docker -y</span><br><span class="line">systemctl start docker; systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">docker pull docker.io/openshift/origin-node:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-control-plane:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-deployer:v3.11.0</span><br><span class="line">docker pull docker.io/openshift/origin-haproxy-router:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-pod:v3.11.0</span><br><span class="line">docker pull docker.io/openshift/origin-web-console:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-docker-registry:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-metrics-server:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-console:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-metrics-heapster:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-metrics-hawkular-metrics:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-metrics-schema-installer:v3.11</span><br><span class="line">docker pull docker.io/openshift/origin-metrics-cassandra:v3.11</span><br><span class="line">docker pull docker.io/cockpit/kubernetes:latest</span><br><span class="line">docker pull quay.io/coreos/cluster-monitoring-operator:v0.1.1</span><br><span class="line">docker pull quay.io/coreos/prometheus-config-reloader:v0.23.2</span><br><span class="line">docker pull quay.io/coreos/prometheus-operator:v0.23.2</span><br><span class="line">docker pull docker.io/openshift/prometheus-alertmanager:v0.15.2</span><br><span class="line">docker pull docker.io/openshift/prometheus-node-exporter:v0.16.0</span><br><span class="line">docker pull docker.io/openshift/prometheus:v2.3.2</span><br><span class="line">docker pull docker.io/grafana/grafana:5.2.1</span><br><span class="line">docker pull quay.io/coreos/kube-rbac-proxy:v0.3.1</span><br><span class="line">docker pull quay.io/coreos/etcd:v3.2.22</span><br><span class="line">docker pull quay.io/coreos/kube-state-metrics:v1.3.1</span><br><span class="line">docker pull docker.io/openshift/oauth-proxy:v1.1.0</span><br><span class="line">docker pull quay.io/coreos/configmap-reload:v0.0.1</span><br></pre></td></tr></table></figure>
<p>之后将下载的镜像导出到新节点上，可以借助批量导出工具：<br><a href="https://github.com/laoshanxi/saveloadimg" target="_blank" rel="noopener">镜像批量导出工具</a>  </p>
<h2 id="在所有节点执行如下任务，本文以playbook的方式执行。"><a href="#在所有节点执行如下任务，本文以playbook的方式执行。" class="headerlink" title="在所有节点执行如下任务，本文以playbook的方式执行。"></a>在所有节点执行如下任务，本文以playbook的方式执行。</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Pre Install</span><br><span class="line">  hosts: nodes</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">  - name: <span class="built_in">set</span> selinux</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"sed  -i 's/SELINUX=disabled/SELINUX=permissive/g'  /etc/selinux/config"</span></span><br><span class="line">  </span><br><span class="line">  - name: install tools</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"yum install -y wget git net-tools bind-utils yum-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct vim python-setuptools unzip tree atomic NetworkManager"</span></span><br><span class="line">  </span><br><span class="line">  - name: install repo</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"yum install -y centos-release-openshift-origin311 ceph-common container-selinux epel extras python-docker"</span></span><br><span class="line">  </span><br><span class="line">  - name: install origin</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"yum install -y origin-node-3.11.0 origin-clients-3.11.0 conntrack-tools origin-3.11.0"</span></span><br><span class="line"></span><br><span class="line">  - name: <span class="built_in">set</span> docker <span class="built_in">enable</span></span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"systemctl enable NetworkManager"</span></span><br><span class="line"></span><br><span class="line">  - name: <span class="built_in">disable</span> firewalld</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"systemctl stop firewalld"</span></span><br><span class="line"></span><br><span class="line">  - name: <span class="built_in">disable</span> firewalld</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">"systemctl disable firewalld"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#所有节点配置iptables</span></span><br><span class="line">cp /etc/sysconfig/iptables /etc/sysconfig/iptables.bak.$(date <span class="string">"+%Y%m%d%H%M%S"</span>);</span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p tcp -m state --state NEW -m tcp --dport 53 -j ACCEPT'</span> /etc/sysconfig/iptables;</span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p udp -m state --state NEW -m udp --dport 53 -j ACCEPT'</span> /etc/sysconfig/iptables;</span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p tcp -m state --state NEW -m tcp --dport 5000 -j ACCEPT'</span> /etc/sysconfig/iptables;</span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p tcp -m state --state NEW -m tcp --dport 81 -j ACCEPT'</span> /etc/sysconfig/iptables;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在master节点允许 8443 for node join</span></span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p tcp -m state --state NEW -m tcp --dport 8443 -j ACCEPT '</span> /etc/sysconfig/iptables;</span><br><span class="line">sed -i <span class="string">'/.*--dport 22 -j ACCEPT.*/a\-A INPUT -p tcp -m state --state NEW -m tcp --dport 8443 -j ACCEPT '</span> /etc/sysconfig/iptables;</span><br><span class="line"></span><br><span class="line">systemctl restart iptables;systemctl <span class="built_in">enable</span> iptables</span><br></pre></td></tr></table></figure>

<h2 id="在ansible主机执行如下操作"><a href="#在ansible主机执行如下操作" class="headerlink" title="在ansible主机执行如下操作"></a>在ansible主机执行如下操作</h2><p>本文以openshift1作为安装主机</p>
<h3 id="配置ansible免密登录"><a href="#配置ansible免密登录" class="headerlink" title="配置ansible免密登录"></a>配置ansible免密登录</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -f ~/.ssh/id_rsa -N <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> openshift1 openshift2 openshift3</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="variable">$host</span></span><br><span class="line">     ssh-copy-id -i ~/.ssh/id_rsa.pub <span class="variable">$host</span>;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="安装openshift-ansible"><a href="#安装openshift-ansible" class="headerlink" title="安装openshift-ansible"></a>安装openshift-ansible</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y ansible-2.6.14-1.el7</span><br><span class="line">yum install -y openshift-ansible</span><br></pre></td></tr></table></figure>
<h3 id="如果使用Open-VSwitch虚拟网络，hosts文件如下"><a href="#如果使用Open-VSwitch虚拟网络，hosts文件如下" class="headerlink" title="如果使用Open VSwitch虚拟网络，hosts文件如下"></a>如果使用Open VSwitch虚拟网络，hosts文件如下</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@openshift1 ~]<span class="comment"># cat /etc/ansible/hosts</span></span><br><span class="line"><span class="comment"># Create an OSEv3 group that contains the masters, nodes, and etcd groups</span></span><br><span class="line">[OSEv3:children]</span><br><span class="line">masters</span><br><span class="line">nodes</span><br><span class="line">etcd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set variables common for all OSEv3 hosts</span></span><br><span class="line">[OSEv3:vars]</span><br><span class="line"><span class="comment"># SSH user, this user should allow ssh based auth without requiring a password</span></span><br><span class="line">ansible_ssh_user=root</span><br><span class="line"><span class="comment">#openshift_deployment_type=openshift-enterprise</span></span><br><span class="line">openshift_deployment_type=origin</span><br><span class="line">openshift_release=<span class="string">"3.11"</span></span><br><span class="line">openshift_image_tag=v3.11</span><br><span class="line">openshift_pkg_version=-3.11.0</span><br><span class="line">openshift_use_openshift_sdn=<span class="literal">true</span></span><br><span class="line"><span class="comment"># If ansible_ssh_user is not root, ansible_become must be set to true</span></span><br><span class="line"><span class="comment">#ansible_become=true</span></span><br><span class="line"><span class="comment">#containerized=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default selectors for router and registry services</span></span><br><span class="line"><span class="comment"># openshift_router_selector='node-role.kubernetes.io/infra=true'</span></span><br><span class="line"><span class="comment"># openshift_registry_selector='node-role.kubernetes.io/infra=true'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment the following to enable htpasswd authentication; defaults to DenyAllPasswordIdentityProvider</span></span><br><span class="line">openshift_master_identity_providers=[&#123;<span class="string">'name'</span>: <span class="string">'htpasswd_auth'</span>, <span class="string">'login'</span>: <span class="string">'true'</span>, <span class="string">'challenge'</span>: <span class="string">'true'</span>, <span class="string">'kind'</span>: <span class="string">'HTPasswdPasswordIdentityProvider'</span>&#125;]</span><br><span class="line"><span class="comment">#openshift_master_default_subdomain=ai.com</span></span><br><span class="line">openshift_disable_check=memory_availability,disk_availability,docker_image_availability</span><br><span class="line"></span><br><span class="line">os_sdn_network_plugin_name=<span class="string">'redhat/openshift-ovs-networkpolicy'</span></span><br><span class="line"></span><br><span class="line">openshift_master_cluster_method=native</span><br><span class="line">openshift_master_cluster_hostname=openshift1</span><br><span class="line">openshift_master_cluster_public_hostname=openshift1</span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">ansible_service_broker_install=<span class="literal">false</span></span><br><span class="line">openshift_enable_service_catalog=<span class="literal">false</span></span><br><span class="line">template_service_broker_install=<span class="literal">false</span></span><br><span class="line">openshift_logging_install_logging=<span class="literal">false</span></span><br><span class="line">enable_excluders=<span class="literal">false</span></span><br><span class="line"><span class="comment"># registry passwd</span></span><br><span class="line"><span class="comment">#oreg_url=10.1.236.77:5000/openshift3/ose-$&#123;component&#125;:$&#123;version&#125;</span></span><br><span class="line"><span class="comment">#oreg_url=10.1.236.77:5000/openshift/origin-$&#123;component&#125;:$&#123;version&#125;</span></span><br><span class="line"><span class="comment">#openshift_examples_modify_imagestreams=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker config</span></span><br><span class="line"><span class="comment">#openshift_docker_additional_registries=10.1.236.77:5000</span></span><br><span class="line"><span class="comment">#openshift_docker_insecure_registries=10.1.236.77:5000</span></span><br><span class="line"><span class="comment">#openshift_docker_blocked_registries</span></span><br><span class="line">openshift_docker_options=<span class="string">"--log-driver json-file --log-opt max-size=1M --log-opt max-file=3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># openshift_cluster_monitoring_operator_install=false</span></span><br><span class="line"><span class="comment"># openshift_metrics_install_metrics=true</span></span><br><span class="line"><span class="comment"># openshift_enable_unsupported_configurations=True</span></span><br><span class="line"><span class="comment">#openshift_logging_es_nodeselector='node-role.kubernetes.io/infra: "true"'</span></span><br><span class="line"><span class="comment">#openshift_logging_kibana_nodeselector='node-role.kubernetes.io/infra: "true"'</span></span><br><span class="line"><span class="comment"># host group for masters</span></span><br><span class="line"></span><br><span class="line">[masters]</span><br><span class="line">openshift1</span><br><span class="line">openshift2</span><br><span class="line">openshift3</span><br><span class="line">openshift4</span><br><span class="line"></span><br><span class="line"><span class="comment"># host group for etcd</span></span><br><span class="line">[etcd]</span><br><span class="line">openshift1</span><br><span class="line">openshift2</span><br><span class="line">openshift3</span><br><span class="line">openshift4</span><br><span class="line"></span><br><span class="line"><span class="comment"># host group for nodes, includes region info</span></span><br><span class="line">[nodes]</span><br><span class="line">openshift1 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift2 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift3 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift4  openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br></pre></td></tr></table></figure>
<h3 id="如果使用calico虚拟网络，配置文件如下："><a href="#如果使用calico虚拟网络，配置文件如下：" class="headerlink" title="如果使用calico虚拟网络，配置文件如下："></a>如果使用calico虚拟网络，配置文件如下：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@openshift1 ~]<span class="comment"># cat /etc/ansible/hosts    </span></span><br><span class="line"><span class="comment"># Create an OSEv3 group that contains the masters, nodes, and etcd groups</span></span><br><span class="line">[OSEv3:children]</span><br><span class="line">masters</span><br><span class="line">nodes</span><br><span class="line">etcd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set variables common for all OSEv3 hosts</span></span><br><span class="line">[OSEv3:vars]</span><br><span class="line"><span class="comment"># bellow 3 parameter for Calico</span></span><br><span class="line">os_sdn_network_plugin_name=cni</span><br><span class="line">openshift_use_calico=<span class="literal">true</span></span><br><span class="line">openshift_use_openshift_sdn=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH user, this user should allow ssh based auth without requiring a password</span></span><br><span class="line">ansible_ssh_user=root</span><br><span class="line"><span class="comment">#openshift_deployment_type=openshift-enterprise</span></span><br><span class="line">openshift_deployment_type=origin</span><br><span class="line">openshift_release=<span class="string">"3.11"</span></span><br><span class="line">openshift_image_tag=v3.11</span><br><span class="line">openshift_pkg_version=-3.11.0</span><br><span class="line"><span class="comment">#openshift_use_openshift_sdn=true</span></span><br><span class="line"><span class="comment"># If ansible_ssh_user is not root, ansible_become must be set to true</span></span><br><span class="line"><span class="comment">#ansible_become=true</span></span><br><span class="line"><span class="comment">#containerized=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># default selectors for router and registry services</span></span><br><span class="line"><span class="comment"># openshift_router_selector='node-role.kubernetes.io/infra=true'</span></span><br><span class="line"><span class="comment"># openshift_registry_selector='node-role.kubernetes.io/infra=true'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment the following to enable htpasswd authentication; defaults to DenyAllPasswordIdentityProvider</span></span><br><span class="line">openshift_master_identity_providers=[&#123;<span class="string">'name'</span>: <span class="string">'htpasswd_auth'</span>, <span class="string">'login'</span>: <span class="string">'true'</span>, <span class="string">'challenge'</span>: <span class="string">'true'</span>, <span class="string">'kind'</span>: <span class="string">'HTPasswdPasswordIdentityProvider'</span>&#125;]</span><br><span class="line"><span class="comment">#openshift_master_default_subdomain=ai.com</span></span><br><span class="line">openshift_disable_check=memory_availability,disk_availability,docker_image_availability,docker_storage</span><br><span class="line"></span><br><span class="line"><span class="comment">#os_sdn_network_plugin_name='redhat/openshift-ovs-networkpolicy'</span></span><br><span class="line"></span><br><span class="line">openshift_master_cluster_method=native</span><br><span class="line">openshift_master_cluster_hostname=openshift1</span><br><span class="line">openshift_master_cluster_public_hostname=openshift1</span><br><span class="line"><span class="comment"># false</span></span><br><span class="line">ansible_service_broker_install=<span class="literal">false</span></span><br><span class="line">openshift_enable_service_catalog=<span class="literal">false</span></span><br><span class="line">template_service_broker_install=<span class="literal">false</span></span><br><span class="line">openshift_logging_install_logging=<span class="literal">false</span></span><br><span class="line">enable_excluders=<span class="literal">false</span></span><br><span class="line"><span class="comment"># registry passwd</span></span><br><span class="line"><span class="comment">#oreg_url=10.1.236.77:5000/openshift3/ose-$&#123;component&#125;:$&#123;version&#125;</span></span><br><span class="line"><span class="comment">#oreg_url=10.1.236.77:5000/openshift/origin-$&#123;component&#125;:$&#123;version&#125;</span></span><br><span class="line"><span class="comment">#openshift_examples_modify_imagestreams=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker config</span></span><br><span class="line"><span class="comment">#openshift_docker_additional_registries=10.1.236.77:5000</span></span><br><span class="line"><span class="comment">#openshift_docker_insecure_registries=10.1.236.77:5000</span></span><br><span class="line"><span class="comment">#openshift_docker_blocked_registries</span></span><br><span class="line">openshift_docker_options=<span class="string">"--log-driver json-file --log-opt max-size=1M --log-opt max-file=3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># openshift_cluster_monitoring_operator_install=false</span></span><br><span class="line"><span class="comment"># openshift_metrics_install_metrics=true</span></span><br><span class="line"><span class="comment"># openshift_enable_unsupported_configurations=True</span></span><br><span class="line"><span class="comment">#openshift_logging_es_nodeselector='node-role.kubernetes.io/infra: "true"'</span></span><br><span class="line"><span class="comment">#openshift_logging_kibana_nodeselector='node-role.kubernetes.io/infra: "true"'</span></span><br><span class="line"><span class="comment"># host group for masters</span></span><br><span class="line"></span><br><span class="line">[masters]</span><br><span class="line">openshift1</span><br><span class="line">openshift2</span><br><span class="line">openshift3</span><br><span class="line">openshift4</span><br><span class="line"></span><br><span class="line"><span class="comment"># host group for etcd</span></span><br><span class="line">[etcd]</span><br><span class="line">openshift1</span><br><span class="line">openshift2</span><br><span class="line">openshift3</span><br><span class="line">openshift4</span><br><span class="line"></span><br><span class="line"><span class="comment"># host group for nodes, includes region info</span></span><br><span class="line">[nodes]</span><br><span class="line">openshift1 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift2 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift3 openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br><span class="line">openshift2  openshift_node_group_name=<span class="string">'node-config-all-in-one'</span></span><br></pre></td></tr></table></figure>
<h3 id="配置DNS解析"><a href="#配置DNS解析" class="headerlink" title="配置DNS解析"></a>配置DNS解析</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/hosts</span><br><span class="line">    127.0.0.1 VM_0_60_centos VM_0_60_centos</span><br><span class="line">    127.0.0.1 localhost.localdomain localhost</span><br><span class="line">    127.0.0.1 localhost4.localdomain4 localhost4</span><br><span class="line">    </span><br><span class="line">    ::1 VM_0_60_centos VM_0_60_centos</span><br><span class="line">    ::1 localhost.localdomain localhost</span><br><span class="line">    ::1 localhost6.localdomain6 localhost6</span><br><span class="line">    </span><br><span class="line">    10.0.0.60 openshift1</span><br><span class="line">    10.0.0.63 openshift2</span><br><span class="line">    10.0.5.17 openshift3</span><br><span class="line">    10.0.5.8 openshift4</span><br><span class="line"></span><br><span class="line">ansible all -m copy -a <span class="string">"src=/etc/hosts dest=/etc/hosts "</span></span><br></pre></td></tr></table></figure>
<h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ansible all -a <span class="string">'systemctl start docker;systemctl enable docker'</span></span><br></pre></td></tr></table></figure>

<h3 id="执行检查"><a href="#执行检查" class="headerlink" title="执行检查"></a>执行检查</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml</span><br></pre></td></tr></table></figure>

<h3 id="执行安装"><a href="#执行安装" class="headerlink" title="执行安装"></a>执行安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml -vvv</span><br></pre></td></tr></table></figure>

<h3 id="如果安装过程出错或者想要重新安装，需要先卸载"><a href="#如果安装过程出错或者想要重新安装，需要先卸载" class="headerlink" title="如果安装过程出错或者想要重新安装，需要先卸载"></a>如果安装过程出错或者想要重新安装，需要先卸载</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ansible-playbook  /usr/share/ansible/openshift-ansible/playbooks/adhoc/uninstall.yml</span><br></pre></td></tr></table></figure>
<h3 id="配置后台登录用户"><a href="#配置后台登录用户" class="headerlink" title="配置后台登录用户"></a>配置后台登录用户</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">htpasswd -cb /etc/origin/master/htpasswd admin abc123</span><br><span class="line">oc adm policy add-cluster-role-to-user cluster-admin admin</span><br></pre></td></tr></table></figure>
<p>之后修改hosts文件，在浏览器输入 <a href="https://openshift1:8443" target="_blank" rel="noopener">https://openshift1:8443</a> 即可访问okd页面，并使用okd311.</p>
<p>安装过程中的问题：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">遇到下面问题需要在对应node上安装atomic包，再次执行安装步骤：</span><br><span class="line">Message: The following packages have pending transactions: atomic-x86_64</span><br><span class="line">ansible 2.8 版本不支持openshift3.11，用ansible2.6.14成功安装。</span><br><span class="line">rpm -e --nodeps ansible-2.8.2-1.el7.noarch</span><br><span class="line">yum install ansible-2.6.14-1.el7</span><br></pre></td></tr></table></figure>

<p>本文参考链接：<br><a href="https://www.jianshu.com/p/cc012c93ad8c" target="_blank" rel="noopener">https://www.jianshu.com/p/cc012c93ad8c</a><br><a href="https://www.jianshu.com/p/47711a21ba49" target="_blank" rel="noopener">https://www.jianshu.com/p/47711a21ba49</a><br><a href="https://www.jianshu.com/p/de0d5b89e231" target="_blank" rel="noopener">https://www.jianshu.com/p/de0d5b89e231</a>  </p>
<p>官方文档：<br><a href="https://docs.okd.io/3.11/install/host_preparation.html" target="_blank" rel="noopener">https://docs.okd.io/3.11/install/host_preparation.html</a></p>
]]></content>
      <categories>
        <category>云原生技术</category>
      </categories>
      <tags>
        <tag>openshift</tag>
        <tag>okd311</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/12/31/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
